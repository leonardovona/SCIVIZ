<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>


    <div position:relative; width="100%" ; height="60%" style="display: flex;">
        <div id="map" class="item">
            <!-- <h2>Water scarcity conditions (WEI+)</h2> -->
        </div>
        <div id="groupedBarChart" class="item">
            <div style="float:right" class="range">
                <input type="range" min="2007" max="2019" steps="1" value="2019" id="year_input" list="steplist">
                <datalist id="steplist">
                    <option value="2007"></option>
                    <option value="2008"></option>
                    <option value="2009"></option>
                    <option value="2010"></option>
                    <option value="2011"></option>
                    <option value="2012"></option>
                    <option value="2013"></option>
                    <option value="2014"></option>
                    <option value="2015"></option>
                    <option value="2016"></option>
                    <option value="2017"></option>
                    <option value="2018"></option>
                    <option value="2019"></option>
                </datalist>
            </div>
            <p>Year: <output id="year"></output></p>
            <!-- !!! This need to be fixed, it resets the year -->
            <button onclick="update_sb()">Total</button>
            <button onclick="update_sb({pollutant: 'TOC'})">TOC</button>
            <button onclick="update_sb({pollutant: 'Nitrogen'})">Nitrogen</button>
            <button onclick="update_sb({pollutant: 'Phosphorus'})">Phosphorus</button>
            <button onclick="update_sb({pollutant: 'Heavy metals (Cd, Hg, Ni, Pb)'})">Heavy metals</button>
            <p><output id="country">EU</output></p>
        </div>
    </div>
    <div position:relative; width="100%" ; height="40%" style="display: flex;">
        <!-- <h2 style="text-align: center;">Industrial pollutant releases to water</h2> -->
        <div id="stackedBarChart" class="item">
        </div>
        <div id="lineChart" class="item">
        </div>
    </div>

    <script>
        const EU_members = ["AT", "BE", "BG", "CY", "CZ", "DE", "DK", "EE", "EL", "ES",
            "FI", "FR", "HR", "HU", "IE", "IT", "LT", "LU", "LV", "MT", "NL", "PL", "PT", "RO", "SE", "SI", "SK"]
    </script>

    <script src="line_chart.js"></script>

    <script>
        let click = function (d) {
            if (EU_members.includes(d.srcElement.__data__.properties.ID)) {
                document.getElementById("country").value = d.srcElement.__data__.properties.NAME
                update_line_chart({ country: d.srcElement.__data__.properties.ID })
            }
        }
    </script>

    <script src="map.js"></script>

    <script src="stacked_bar_chart.js"></script>

    <script>
        const value = document.querySelector("#year")
        const input = document.querySelector("#year_input")
        value.textContent = input.value
        input.addEventListener("input", (event) => {
            value.textContent = event.target.value
            handle_update(event.target.value)
            update_sb({ year: event.target.value })
        })
    </script>
</body>